<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Signup</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  />
  <style>
    .toast {
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen px-4">

  <div class="w-full max-w-md">
    <!-- Logo -->
    <div class="flex justify-center mb-6">
      <img src="https://via.placeholder.com/100x100" alt="Brand Logo" class="h-20 w-20">
    </div>

    <!-- Card -->
    <div class="bg-white shadow-md rounded-2xl p-8">
      <h2 class="text-3xl font-bold text-gray-900 text-center mb-1">Create Your Account</h2>
      <p class="text-gray-500 text-center">Join us to manage your escrow transactions securely</p>

      <!-- Form -->
      <form id="signupForm" class="mt-4 space-y-4">
        
        <!-- Full Name -->
        <div>
          <label class="block text-sm font-medium text-gray-700">Full Name</label>
          <input type="text" id="fullname" placeholder="Full Name"
            class="mt-1 block w-full rounded-lg border border-gray-300 placeholder-gray-400 focus:border-[#1A73E8] focus:ring-[#1A73E8] p-2">
          <p class="mt-1 text-sm text-red-600 hidden" id="fullnameError"></p>
        </div>

        <!-- Email -->
        <div>
          <label class="block text-sm font-medium text-gray-700">Email Address</label>
          <input type="email" id="email" placeholder="Email Address"
            class="mt-1 block w-full rounded-lg border border-gray-300 placeholder-gray-400 focus:border-[#1A73E8] focus:ring-[#1A73E8] p-2">
          <p class="mt-1 text-sm text-red-600 hidden" id="emailError"></p>
        </div>

        <!-- Phone -->
        <div>
          <label class="block text-sm font-medium text-gray-700">Phone Number</label>
          <input type="text" id="phone" placeholder="Phone Number"
            class="mt-1 block w-full rounded-lg border border-gray-300 placeholder-gray-400 focus:border-[#1A73E8] focus:ring-[#1A73E8] p-2">
          <p class="mt-1 text-sm text-red-600 hidden" id="phoneError"></p>
        </div>

        <!-- Password -->
        <div>
          <label class="block text-sm font-medium text-gray-700">Password</label>
          <input type="password" id="password" placeholder="Password"
            class="mt-1 block w-full rounded-lg border border-gray-300 placeholder-gray-400 focus:border-[#1A73E8] focus:ring-[#1A73E8] p-2">
          <p class="mt-1 text-sm text-red-600 hidden" id="passwordError"></p>
        </div>

        <!-- Confirm Password -->
        <div>
          <label class="block text-sm font-medium text-gray-700">Confirm Password</label>
          <input type="password" id="confirmPassword" placeholder="Confirm Password"
            class="mt-1 block w-full rounded-lg border border-gray-300 placeholder-gray-400 focus:border-[#1A73E8] focus:ring-[#1A73E8] p-2">
          <p class="mt-1 text-sm text-red-600 hidden" id="confirmPasswordError"></p>
        </div>

        <!-- Terms -->
        <div class="flex items-center">
          <input id="terms" type="checkbox"
            class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
          <label for="terms" class="ml-2 block text-sm text-gray-700">
            I agree to the <a href="#" class="text-[#1A73E8]">Terms & Conditions</a>
          </label>
        </div>
        <p class="mt-1 text-sm text-red-600 hidden" id="termsError"></p>

        <!-- Button -->
        <button type="submit"
          class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-sm transition">
          Sign Up
        </button>
      </form>

      <!-- Footer -->
      <p class="mt-6 text-center text-sm text-gray-600">
        Already have an account?
        <a href="login.html" class="text-[#1A73E8] font-medium">Login</a>
      </p>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="fixed top-4 right-4 space-y-2 z-50"></div>

  <script>
    const form = document.getElementById('signupForm');
    const toastContainer = document.getElementById('toastContainer');

    // === Session Tracking & Back-button handling ===
    function checkLoginStatus() {
      const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
      if (loggedInUser) {
        // If already logged in, prevent signup page
        window.location.replace("dashboard.html"); 
      }
    }
    checkLoginStatus();

    // Prevent back button from showing login/signup after login
    window.addEventListener("popstate", () => {
      const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
      if (loggedInUser) {
        window.location.replace("dashboard.html");
      }
    });

    // === Toast helper ===
    function showToast(message, type) {
      const toast = document.createElement('div');
      toast.className = `toast flex items-center px-4 py-2 rounded-lg shadow-md ${
        type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
      }`;
      toast.innerHTML = `
        <i class="fa-solid ${type === 'success' ? 'fa-check-circle' : 'fa-times-circle'} mr-2"></i>
        <span>${message}</span>
      `;
      toastContainer.appendChild(toast);

      setTimeout(() => toast.classList.add('show'), 100);
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 400);
      }, 2500);
    }

    // === Form Submit Handler ===
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      // Reset errors (UI reset)
      document.querySelectorAll('p.text-red-600').forEach(el => {
        el.textContent = "";
        el.classList.add('hidden');
      });

      const fullname = document.getElementById('fullname').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const terms = document.getElementById('terms').checked;

      let hasError = false;

      // Validation
      if (!fullname) {
        document.getElementById('fullnameError').textContent = "Full name is required.";
        document.getElementById('fullnameError').classList.remove('hidden');
        hasError = true;
      }

      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;
      if (!emailRegex.test(email)) {
        document.getElementById('emailError').textContent = "Enter a valid email.";
        document.getElementById('emailError').classList.remove('hidden');
        hasError = true;
      }

      if (!phone) {
        document.getElementById('phoneError').textContent = "Phone number is required.";
        document.getElementById('phoneError').classList.remove('hidden');
        hasError = true;
      }

      if (password.length < 8) {
        document.getElementById('passwordError').textContent = "Password must be at least 8 characters.";
        document.getElementById('passwordError').classList.remove('hidden');
        hasError = true;
      }

      if (confirmPassword !== password) {
        document.getElementById('confirmPasswordError').textContent = "Passwords do not match.";
        document.getElementById('confirmPasswordError').classList.remove('hidden');
        hasError = true;
      }

      if (!terms) {
        document.getElementById('termsError').textContent = "You must agree to the terms.";
        document.getElementById('termsError').classList.remove('hidden');
        hasError = true;
      }

      if (hasError) return;

      // Check localStorage for existing users
      let users = JSON.parse(localStorage.getItem('users')) || [];
      if (users.some(u => u.email === email)) {
        showToast("An account with this email already exists", "error");
        return;
      }

      // Add new user
      const newUser = { fullname, email, phone, password };
      users.push(newUser);
      localStorage.setItem('users', JSON.stringify(users));

      // === Session Tracking: keep loggedInUser ===
      localStorage.setItem('loggedInUser', JSON.stringify(newUser));

      showToast("Account created successfully", "success");

      setTimeout(() => {
        window.location.href = "dashboard.html";
      }, 3000);
    });

    // === UI Reset on Load ===
    window.addEventListener("load", () => {
      form.reset(); // clear form
      document.querySelectorAll('p.text-red-600').forEach(el => el.classList.add('hidden'));
      toastContainer.innerHTML = ""; // clear old toasts
    });
  </script>
</body>
</html>